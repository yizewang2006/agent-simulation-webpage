<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playback</title>
  <link rel="stylesheet" href="style.css">
  <!--font families-->
  <!-- Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <h2>Playback Window</h2>
  <div class="center-container">
    <canvas id="playbackCanvas" width="1000" height="1000" ></canvas>
    <div>
      <button id="prevFrame">⏮ Prev</button>
      <input type="range" id="frameSlider" min="0" max="0" value="0">
      <button id="nextFrame">⏭ Next</button>
    </div>
  </div>


<script src="./entity.js"></script>

<script>
  const canvas = document.getElementById("playbackCanvas");
  const ctx = canvas.getContext("2d");

  let frames = [];
  let currentFrame = 0;

  // This will be called from the opener page
  const slider = document.getElementById("frameSlider");

  window.loadRecording = function(recordedFrames) {
    frames = recordedFrames;
    currentFrame = 0;

    // set slider range
    slider.min = 0;
    slider.max = frames.length - 1;
    slider.value = 0;

    showFrame(currentFrame);
  };

  function showFrame(i) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!frames[i]) return;

    // Rebuild each agent and draw it
    frames[i].forEach(info => {
      const agent = new Agent(
        info.x, info.y, info.dx, info.dy,
        info.angle, info.fovAngle, info.fovRadius,
        info.colorHex
      );

      // If your Agent constructor sets defaults differently,
      // you may need to tweak argument order here.

      agent.draw();
    });

    slider.value = i;
  }
</script>
</body>
</html>