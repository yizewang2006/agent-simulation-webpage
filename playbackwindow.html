<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Playback</title>
  <link rel="stylesheet" href="style.css">
  <!--font families-->
  <!-- Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <h2>Playback Window</h2>
  <div class="center-container">
    <canvas id="playbackCanvas" width="1000" height="1000" ></canvas>
    <div>
      <button id="prevFrame">⏮ Prev</button>
      <input type="range" id="frameSlider" min="0" max="0" value="0">
      <button id="nextFrame">⏭ Next</button>
    </div>
  </div>


<script type="module" src="./agent.js"></script>

<script type="module">

  import { Agent } from "./agent.js";

  const canvas = document.getElementById("playbackCanvas");
  const ctx = canvas.getContext("2d");

  // define variables, keys are: how many frames (recover frame data), current frame for control, and 2 agent lists
  let frames = [];
  let currentFrame = 0;
  let specialAgentList = [];
  let normalAgentList = [];

  // This will be called from the opener page
  const slider = document.getElementById("frameSlider");

  // Initiallize the window
  window.loadRecording = function(recordedFrames) {
    frames = recordedFrames;
    currentFrame = 0;

    // set slider range
    slider.min = 0;
    slider.max = frames.length - 1;
    slider.value = 0;

    showFrame(currentFrame);
  };

  function showFrame(i) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!frames[i]) return;

    // Rebuild each agent and draw it
    frames[i].forEach(info => {
      const agent = new Agent(
        true,                 // drawFOV
        info.x, info.y,       // position
        5,                   // radius
        info.dx, info.dy,     // velocity
        info.colorHex,        // colorHex
        info.fovRadius,       // fovRadius
        info.fovAngle,        // fovAngle
        info.angle,           // angle
        info.id         // id (optional, you can use info.id if stored)
      );

      // constructor Agent(drawFOV: any, x: any, y: any, radius: any, dx: any, dy: any, colorHex: string | undefined, fovRadius: number | undefined, fovAngle: number | undefined, angle: number | undefined, id: any): Agent

      agent.draw();
    });

    slider.value = i;
  }
</script>
</body>
</html>